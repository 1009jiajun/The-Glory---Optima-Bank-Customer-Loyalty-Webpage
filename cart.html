<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Optima Bank Rewards - Redeem Your Points for Exclusive Vouchers</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/drift-zoom/drift-basic.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>

<body class="index-page">

  <header id="header" class="header sticky-top">

    <!-- Main Header -->
    <div class="main-header">
      <div class="container-fluid container-xl">
        <div class="d-flex py-3 align-items-center justify-content-between">

          <!-- Logo -->
          <a href="index.html" class="logo d-flex align-items-center">
            <!-- Uncomment the line below if you also wish to use an image logo -->
            <!-- <img src="assets/img/logo.webp" alt=""> -->
            <h1 class="sitename">Optima Bank Rewards</h1>
          </a>

          <!-- Actions -->
          <div class="header-actions d-flex align-items-center justify-content-end">

            <!-- Cart -->
            <a href="cart.html" class="header-action-btn">
              <i class="bi bi-cart3"></i>
              <span class="badge">0</span>
            </a>

            <!-- Account -->
            <div class="dropdown account-dropdown">
              <button class="header-action-btn" data-bs-toggle="dropdown" id="accountBtn">
                <i class="bi bi-person"></i>
              </button>
              <div class="dropdown-menu">
                <div class="dropdown-header">
                  <h6>Welcome to <span class="sitename">Optima Bank</span></h6>
                  <p class="mb-0">Redeem Loyalty Rewards &amp; Manage Account</p>
                </div>
                <div class="dropdown-body">
                  <a class="dropdown-item d-flex align-items-center" href="account.html">
                    <i class="bi bi-person-circle me-2"></i>
                    <span>My Profile</span>
                  </a>
                  <a class="dropdown-item d-flex align-items-center" href="account.html">
                    <i class="bi bi-bag-check me-2"></i>
                    <span>My Redeem History</span>
                  </a>
                  <a class="dropdown-item d-flex align-items-center" href="account.html">
                    <i class="bi bi-coin me-2"></i>
                    <span>My Points Balance</span>
                  </a>
                </div>
                <div class="dropdown-footer" id="authButtons">
                  <a href="login.html" class="btn btn-primary w-100 mb-2">Sign In</a>
                  <a href="register.html" class="btn btn-outline-primary w-100">Register</a>
                </div>
              </div>
            </div>

            <!-- Mobile Navigation Toggle -->
            <i class="mobile-nav-toggle d-xl-none bi bi-list me-0"></i>

          </div>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="header-nav">
      <div class="container-fluid container-xl position-relative">
        <nav id="navmenu" class="navmenu" style="display: flex; align-items: center; justify-content: space-between;">
          <ul>
            <li><a href="index.html" >Home</a></li>
            <li><a href="category.html">Vouchers</a></li>
            <li><a href="cart.html" class="active">Cart</a></li>  
            <li><a href="account.html">Account</a></li>           
          </ul>
          <div class="header-nav-points" style="display: none;">
            <h4 class="current-points" style="font-size: 14px; font-weight: 600; color: white; margin: 15px 0;">Current Points: <span id="currentPoints">0</span></h4>
          </div>
        </nav>
      </div>
    </div>

  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Cart</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Cart</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Cart Section -->
    <section id="cart" class="cart section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row">
          <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">
            <div class="cart-items" id="cartItems">
              <!-- Cart items will be dynamically loaded here --></div>
            <div class="cart-actions">
                <div class="row">
                  <div class="col-lg-6 mb-3 mb-lg-0">
                    <!-- <div class="coupon-form">
                      <div class="input-group">
                        <input type="text" class="form-control" placeholder="Coupon code">
                        <button class="btn btn-outline-accent" type="button">Apply Coupon</button>
                      </div>
                    </div> -->
                  </div>
                  <div class="col-lg-6 text-md-end">
                    <!-- <button class="btn btn-outline-heading me-2">
                      <i class="bi bi-arrow-clockwise"></i> Update Cart
                    </button> -->
                    <button class="btn btn-outline-remove" onclick="clearCart()" style="display:none;">
                      <i class="bi bi-trash"></i> Clear Cart
                    </button>
                  </div>
                </div>
              </div>
          </div>

          <div class="col-lg-4 mt-4 mt-lg-0" data-aos="fade-up" data-aos-delay="300">
            <div class="cart-summary">
              <h4 class="summary-title">Redemption Summary</h4>

              <div class="summary-item">
                <span class="summary-label" style="font-size: 17px;">My Current Points</span>
                <span class="summary-value" style="font-size: 17px;"></span>
              </div>

              <div class="summary-total">
                <span class="summary-label">Total Points Needed</span>
                <span class="summary-value final">0</span>
              </div>

              <div class="checkout-button">
                <a href="#" class="btn btn-accent w-100" onclick="proceedToRedeem()">
                  Redeem Now<i class="bi bi-arrow-right"></i>
                </a>
              </div>

              <div class="continue-shopping">
                <a href="category.html" class="btn btn-link w-100">
                  <i class="bi bi-arrow-left"></i> Continue Browsing
                </a>
              </div>

            </div>
          </div>
        </div>

      </div>

    </section><!-- /Cart Section -->

  </main>

<footer id="footer" class="footer dark-background">
    <div class="footer-main">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-6 col-md-6">
            <div class="footer-widget footer-about">
              <a href="index.html" class="logo">
                <span class="sitename">Optima Bank Rewards</span>
              </a>
              <p>Your trusted partner in redeeming exclusive vouchers and managing your loyalty points with ease.</p>

              <div class="social-links mt-4">
                <h5>Connect With Us</h5>
                <div class="social-icons">
                  <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                  <a href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
                  <a href="#" aria-label="Twitter"><i class="bi bi-twitter-x"></i></a>
                  <a href="#" aria-label="TikTok"><i class="bi bi-tiktok"></i></a>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6 col-md-6">
            <div class="footer-widget">
              <h4>Contact Information</h4>
              <div class="footer-contact">
                <div class="contact-item">
                  <i class="bi bi-geo-alt"></i>
                  <span>Main branch - No 23, Jalan Melati 3, Bandar Melati, 75450 Alor Gajah, Melaka</span>
                </div>
                <div class="contact-item">
                  <i class="bi bi-telephone"></i>
                  <span>+60 12-345 6789</span>
                </div>
                <div class="contact-item">
                  <i class="bi bi-envelope"></i>
                  <span>info@optimabank.com</span>
                </div>
                <div class="contact-item">
                  <i class="bi bi-clock"></i>
                  <span>Monday-Friday: 9am - 6pm<br>Saturday & Sunday: 10am - 3.30pm</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <div class="row gy-3 align-items-center">
          <div class="col-lg-6 col-md-12">
            <div class="copyright">
              <p>© <span>Copyright</span> <strong class="sitename">Optima Bank</strong>. All Rights Reserved.</p>
            </div>
            <div class="credits mt-1">
              <!-- All the links in the footer should remain intact. -->
              <!-- You can delete the links only if you've purchased the pro version. -->
              <!-- Licensing information: https://bootstrapmade.com/license/ -->
              <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
              Designed by The Glory - GIFT UTeM
            </div>
          </div>

          <div class="col-lg-6 col-md-12">
            <div class="d-flex flex-wrap justify-content-lg-end justify-content-center align-items-center gap-4">
              <div class="payment-methods">
                <div class="payment-icons">
                  <i class="bi bi-credit-card" aria-label="Credit Card"></i>
                  <i class="bi bi-paypal" aria-label="PayPal"></i>
                  <i class="bi bi-apple" aria-label="Apple Pay"></i>
                  <i class="bi bi-google" aria-label="Google Pay"></i>
                  <i class="bi bi-cash" aria-label="Cash on Delivery"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/drift-zoom/Drift.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Firebase Initialization and Auth State Management -->
  <script type="module">

  // 🔹 Reusable Toast Function
  function showToast(message, type = "success") {
    const toast = document.createElement("div");
    toast.className = `custom-toast ${type}`;
    toast.textContent = message;

    document.body.appendChild(toast);

    setTimeout(() => {
      toast.remove();
    }, 3000);
  }

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } 
    from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import firebaseConfig from "./config.js";   // ✅ import the config

  // 🔹 Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const authButtons = document.getElementById("authButtons");
  const accountBtn = document.getElementById("accountBtn");

  // 🔹 Listen for login state changes
// 🔹 Check Firebase Auth first
onAuthStateChanged(auth, (user) => {
  if (user) {
    // Firebase user
    fetch("http://localhost/TheGlory/getUser.php?uid=" + user.uid)
      .then((res) => res.json())
      .then((dbUser) => {
        let photoURL = dbUser.profile_image || "assets/img/default-avatar.png";
        accountBtn.innerHTML = `
          <img src="${photoURL}" 
               alt="User Avatar" 
               class="rounded-circle" 
               style="width:32px; height:32px; object-fit:cover;">
        `;    
        if (dbUser.points !== undefined) {
          document.querySelector('.summary-item .summary-value').textContent = dbUser.points;
        }
      });

    document.querySelector(".dropdown-header h6").textContent =
      `Welcome ${user.displayName}`;

    authButtons.innerHTML = `
      <button id="logoutBtn" class="btn btn-danger w-100">Logout</button>
    `;

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      try {
        await signOut(auth);
        sessionStorage.removeItem("user"); // clear normal session too
        setTimeout(() => location.reload(), 1500);
        showToast("Logged out successfully", "success");
      } catch (err) {
        showToast("Logout failed: " + err.message, "error");
      }
    });

  } else {
    // 🔹 If not Firebase, check normal login session
    const localUser = JSON.parse(sessionStorage.getItem("user"));
    if (localUser) {
      // Normal user UI update
      accountBtn.innerHTML = `
        <img src="assets/img/default-avatar.png"
             alt="User Avatar"
             class="rounded-circle"
             style="width:32px; height:32px; object-fit:cover;">
      `;

      document.querySelector(".dropdown-header h6").textContent =
        `Welcome ${localUser.username}`;

      if (localUser.points !== undefined) {
        document.querySelector('.summary-item .summary-value').textContent = localUser.points;
      }

      authButtons.innerHTML = `
        <button id="logoutBtn" class="btn btn-danger w-100">Logout</button>
      `;

      document.getElementById("logoutBtn").addEventListener("click", () => {
        sessionStorage.removeItem("user");
        setTimeout(() => location.reload(), 1500);
        showToast("Logged out successfully", "success");
      });

    } else {
      // Guest
      document.querySelector(".dropdown-header h6").textContent =
        `Welcome to Optima Bank`;

      authButtons.innerHTML = `
        <a href="login.html" class="btn btn-primary w-100 mb-2">Sign In</a>
        <a href="register.html" class="btn btn-outline-primary w-100">Register</a>
      `;
    }
  }
});
</script>

<script>
async function loadCart() {
  const localUser = JSON.parse(sessionStorage.getItem("user"));
  if (!localUser) {
    document.getElementById("cartItems").innerHTML = "<p>Please log in to view your cart.</p>";
    return;
  }

  let cartQty = JSON.parse(sessionStorage.getItem("cartCount")) || 0;
  document.querySelector(".header-action-btn .badge").textContent = cartQty;

  let PointsBalance = localUser?.points || 0;
  document.getElementById("currentPoints").textContent = PointsBalance;
  document.querySelector(".header-nav-points").style.display = localUser ? "block" : "none";

  try {
    const res = await fetch(`http://localhost/TheGlory/getCart.php?user_id=${localUser.id}`);
    const cart = await res.json();

    if (!cart.items || cart.items.length === 0) {
      document.getElementById("cartItems").innerHTML = "<p>Your cart is empty.</p>";
      return;
    }

    document.querySelector(".btn-outline-remove").style.display = "inline-block";

    let html = `
      <div class="cart-header d-none d-lg-block">
        <div class="row align-items-center">
          <div class="col-lg-4"><h5>Reward</h5></div>
          <div class="col-lg-2 text-center"><h5>Points</h5></div>
          <div class="col-lg-2 text-center"><h5>Quantity</h5></div>
          <div class="col-lg-2 text-center"><h5>Sub-total</h5></div>
          <div class="col-lg-2 text-center"><h5>Select</h5></div>
        </div>
      </div>
    `;

    cart.items.forEach(item => {
      const subTotal = item.points * item.quantity;

      html += `
        <div class="cart-item">
          <div class="row align-items-center">
            <div class="col-lg-4 col-12 mt-3 mt-lg-0 mb-lg-0 mb-3">
              <div class="product-info d-flex align-items-center" style="padding: 0px;">
                <div class="product-image" style="width: 7rem; height: 7rem;">
                  <img src="${item.image}" alt="Product" class="img-fluid" loading="lazy">
                </div>
                <div class="product-details">
                  <h6 class="product-title">${item.title}</h6>
                  <button class="remove-item" type="button" onclick="removeFromCart(${item.voucher_id})">
                    <i class="bi bi-trash"></i> Remove
                  </button>
                </div>
              </div>
            </div>
            <div class="col-lg-2 col-12 mt-3 mt-lg-0 text-center">
              <div class="price-tag"><span>${item.points}</span></div>
            </div>
            <div class="col-lg-2 col-12 mt-3 mt-lg-0 text-center">
              <div class="quantity-selector">
                <button class="quantity-btn decrease" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">
                  <i class="bi bi-dash"></i>
                </button>
                <input type="number" class="quantity-input" value="${item.quantity}" min="1" readonly>
                <button class="quantity-btn increase" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">
                  <i class="bi bi-plus"></i>
                </button>
              </div>
            </div>
            <div class="col-lg-2 col-12 mt-3 mt-lg-0 text-center">
              <div class="item-total"><span>${subTotal}</span></div>
            </div>
            <div class="col-lg-2 col-12 mt-3 mt-lg-0 text-center">
              <div class="select-item">
                <input type="checkbox" class="form-check-input cart-checkbox" 
                  data-subtotal="${subTotal}" style="transform: scale(1.5);" checked>
              </div>
            </div>
          </div>
        </div>
      `;
    });

    html += `<div class="summary-total mt-4"> <span class="summary-label">Total Points Needed</span> <span class="summary-value final2"></span> </div>`;

    document.getElementById("cartItems").innerHTML = html;

    // 🔹 Attach event listener for recalculating total
    document.querySelectorAll(".cart-checkbox").forEach(cb => {
      cb.addEventListener("change", updateTotalPoints);
    });

    // 🔹 Initial calculation
    updateTotalPoints();

  } catch (err) {
    console.error("Error loading cart:", err);
    document.getElementById("cartItems").innerHTML = "<p>Failed to load cart.</p>";
  }
}

// 🔹 Function to recalculate total based on checked items
function updateTotalPoints() {
  let total = 0;
  document.querySelectorAll(".cart-checkbox:checked").forEach(cb => {
    total += parseInt(cb.dataset.subtotal);

    // Please disable this section if its not working
    // Sections starts here:
      let itemPoints = parseInt(cb.dataset.subtotal);
      if (itemPoints > localUser.points) {
          cb.disabled = true;
          const cartItem = cb.closest(".cart-item");
          cartItem.style.opacity = "0.5";       // make it look greyed out
          cartItem.style.pointerEvents = "none"; // prevent clicking
      }
    // Sections ends here
    // By Kai Jun
  });
  document.querySelector(".summary-value.final").textContent = total;
  document.querySelector(".summary-value.final2").textContent = total;  
}

async function removeFromCart(cartItemId) {
  if (!confirm("Remove this item?")) return;
  const res = await fetch(`http://localhost/TheGlory/removeCart.php?id=${cartItemId}`);
  const data = await res.json();
  currentCartQty = JSON.parse(sessionStorage.getItem("cartCount")) || 0;
  latestCartQty = currentCartQty - 1;
  sessionStorage.setItem("cartCount", latestCartQty);
  document.querySelector(".header-action-btn .badge").textContent = latestCartQty;
  loadCart();
}

async function updateQuantity(cartItemId, newQty) {
  if (newQty < 1) {
    alert("Quantity cannot be less than 1.");
    return;
  }
  const res2 = await fetch(`http://localhost/TheGlory/updateCart.php?id=${cartItemId}&quantity=${newQty}`);
  const data = await res2.json();
  latestCartQty = data.totalItems; // Get updated total items from response
  let cartQty = JSON.parse(sessionStorage.getItem("cartCount")) || 0;
  sessionStorage.setItem("cartCount", latestCartQty);
  document.querySelector(".header-action-btn .badge").textContent = latestCartQty;
  loadCart();
}

// Clear all cart items for logged-in user
async function clearCart() {
  if (!confirm("Clear all items from cart?")) return;
  const localUser = JSON.parse(sessionStorage.getItem("user"));
  if (!localUser) {
    alert("Please log in to clear your cart.");
    return;
  }
  const res = await fetch(`http://localhost/TheGlory/clearCart.php?user_id=${localUser.id}`);
  const data = await res.json();
  if (data.status === "success") {
    sessionStorage.setItem("cartCount", 0);
    document.querySelector(".header-action-btn .badge").textContent = 0;
    document.querySelector(".summary-value.final").textContent = 0;
    loadCart();
    document.querySelector(".btn-outline-remove").style.display = "none";
    showToast("Cart cleared successfully", "success");
  } else {
    showToast("Failed to clear cart", "error");
  }
}

document.addEventListener("DOMContentLoaded", loadCart);
</script>

<script>
  // 🔹 Reusable Toast Function
function showToast(message, type = "success") {
  const toast = document.createElement("div");
  toast.className = `custom-toast ${type}`;
  toast.textContent = message;

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.remove();
  }, 3000);
}

function generateVoucherCode(length = 8) {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  let code = "";
  for (let i = 0; i < length; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

async function proceedToRedeem() {
  // confirm action
  if (!confirm("Confirm redemption of selected vouchers?")) return;
  // Ensure user is logged in
  const localUser = JSON.parse(sessionStorage.getItem("user"));
  if (!localUser) {
    showToast("Please log in to redeem.", "error");
    return;
  }

  // if the balance not enough to redeem for selected items
  let total = 0;
  document.querySelectorAll(".cart-checkbox:checked").forEach(cb => {
    total += parseInt(cb.dataset.subtotal);
  });
  if (total > localUser.points) {
    showToast("Insufficient points for selected items.", "error");
    return;
  }

  // at least one item selected
  const checkboxes = document.querySelectorAll(".cart-checkbox");
  const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
  if (!anyChecked) {
    showToast("Please select at least one item to redeem.", "error");
    return;
  }

  // Collect selected items
  const selectedItems = [];
  document.querySelectorAll(".cart-item").forEach((itemEl) => {
    const checkbox = itemEl.querySelector(".cart-checkbox");
    if (checkbox && checkbox.checked) {
      const voucherId = itemEl.querySelector(".remove-item").getAttribute("onclick").match(/\d+/)[0]; // extract id from button
      const voucherQuantity = parseInt(itemEl.querySelector(".quantity-input").value, 10);
      for (let i = 0; i < voucherQuantity; i++) {
        selectedItems.push({
          voucher_id: voucherId,
          quantity: 1,
        code: generateVoucherCode(10)
      });
      }
    }
  });

  if (selectedItems.length === 0) {
    showToast("Please select at least one item.", "error");
    return;
  }

  try {
    const res = await fetch("http://localhost/TheGlory/redeem.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        user_id: localUser.id,
        items: selectedItems
      })
    });

    const data = await res.json();
    if (data.status === "success") {
      showToast("Redemption successful! Use Voucher Code to redeem your rewards", "success");
      // previous cart count - number of selected items
      let cartQty = JSON.parse(sessionStorage.getItem("cartCount")) || 0;
      cartQty -= selectedItems.reduce((sum, item) => sum + parseInt(item.quantity), 0);
      cartQty = Math.max(cartQty, 0); // prevent negative
      sessionStorage.setItem("cartCount", cartQty);
      document.querySelector(".header-action-btn .badge").textContent = cartQty;
      // remove redeemed items from cart UI & database
      document.querySelectorAll(".cart-checkbox:checked").forEach(cb => {
        cb.closest(".cart-item").remove();
      }); 
      // update user points in session
      localUser.points -= total;
      sessionStorage.setItem("user", JSON.stringify(localUser));
      loadCart();
      setTimeout(() => { window.location.href = "account.html#orders"; }, 3000);
    } else {
      showToast("Redemption failed: " + data.message, "error");
    }
  } catch (err) {
    console.error(err);
    showToast("Error redeeming vouchers", "error");
  }
}
</script>


</body>

</html>