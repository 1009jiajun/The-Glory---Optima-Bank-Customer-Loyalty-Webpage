<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Optima Bank Rewards - Redeem Your Points for Exclusive Vouchers</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/drift-zoom/drift-basic.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <style>
  .info-row {
    display: flex;
    align-items: center;
    gap: 5px; /* spacing between label and value */
  }

  .info-row .truncate-text {
    flex: 1; /* take up remaining space */
    min-width: 0; /* IMPORTANT for flex ellipsis to work */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 17px;
    font-weight: 400;
    color: #44444499;
  }
  </style>
</head>

<body class="index-page">

  <header id="header" class="header sticky-top">

    <!-- Main Header -->
    <div class="main-header">
      <div class="container-fluid container-xl">
        <div class="d-flex py-3 align-items-center justify-content-between">

          <!-- Logo -->
          <a href="index.html" class="logo d-flex align-items-center">
            <!-- Uncomment the line below if you also wish to use an image logo -->
            <!-- <img src="assets/img/logo.webp" alt=""> -->
            <h1 class="sitename">Optima Bank Rewards</h1>
          </a>

          <!-- Actions -->
          <div class="header-actions d-flex align-items-center justify-content-end">

            <!-- Cart -->
            <a href="cart.html" class="header-action-btn">
              <i class="bi bi-cart3"></i>
              <span class="badge">0</span>
            </a>

            <!-- Account -->
            <div class="dropdown account-dropdown">
              <button class="header-action-btn" data-bs-toggle="dropdown" id="accountBtn">
                <i class="bi bi-person"></i>
              </button>
              <div class="dropdown-menu">
                <div class="dropdown-header">
                  <h6>Welcome to <span class="sitename">Optima Bank</span></h6>
                  <p class="mb-0">Redeem Loyalty Rewards &amp; Manage Account</p>
                </div>
                <div class="dropdown-body">
                  <a class="dropdown-item d-flex align-items-center" data-bs-toggle="tab" data-tab="settings" href="#settings">
                    <i class="bi bi-person-circle me-2"></i>
                    <span>My Profile</span>
                  </a>
                  <a class="dropdown-item d-flex align-items-center" data-bs-toggle="tab" data-tab="orders" href="#orders">
                    <i class="bi bi-bag-check me-2"></i>
                    <span>My Redeem History</span>
                  </a>
                  <a class="dropdown-item d-flex align-items-center" data-bs-toggle="tab" data-tab="points" href="#points">
                    <i class="bi bi-coin me-2"></i>
                    <span>My Points Balance</span>
                  </a>
                </div>
                <div class="dropdown-footer" id="authButtons">
                  <a href="login.html" class="btn btn-primary w-100 mb-2">Sign In</a>
                  <a href="register.html" class="btn btn-outline-primary w-100">Register</a>
                </div>
              </div>
            </div>

            <!-- Mobile Navigation Toggle -->
            <i class="mobile-nav-toggle d-xl-none bi bi-list me-0"></i>

          </div>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="header-nav">
      <div class="container-fluid container-xl position-relative">
        <nav id="navmenu" class="navmenu">
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="category.html">Vouchers</a></li>
            <li><a href="cart.html">Cart</a></li>  
            <li><a href="account.html" class="active">Account</a></li>          
          </ul>
        </nav>
      </div>
    </div>

  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Account</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">Account</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Account Section -->
    <section id="account" class="account section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <!-- Mobile Menu Toggle -->
        <div class="mobile-menu d-lg-none mb-4">
          <button class="mobile-menu-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#profileMenu">
            <i class="bi bi-grid"></i>
            <span>Menu</span>
          </button>
        </div>

        <div class="row g-4" id="ProfileSection">
          <!-- Profile Menu -->
          <div class="col-lg-3">
            <div class="profile-menu collapse d-lg-block" id="profileMenu">
              <!-- User Info -->
              <div class="user-info" data-aos="fade-right">
                <div class="user-avatar">
                  <img src="" alt="Profile" loading="lazy" id="userAvatar">
                  <span class="status-badge"><i class="bi bi-shield-check"></i></span>
                </div>
                <h4 id="userName">User 1</h4>
                <div class="user-status">
                  <i class="bi bi-award"></i>
                  <span>Member</span>
                </div>
              </div>

              <!-- Navigation Menu -->
              <nav class="menu-nav">
                <ul class="nav flex-column" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" data-tab="orders" href="#orders">
                      <i class="bi bi-box-seam"></i>
                      <span>Redeem History</span>
                      <span class="badge">0</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" data-tab="points" href="#points">
                      <i class="bi bi-heart"></i>
                      <span>My Points Balance</span>
                      <span class="badge"></span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" data-tab="settings" href="#settings">
                      <i class="bi bi-gear"></i>
                      <span>Profile Settings</span>
                    </a>
                  </li>
                </ul>

                <div class="menu-footer" style="margin-top: 10px;padding-top: 10px;">
                  <!-- <a href="#" class="help-link">
                    <i class="bi bi-question-circle"></i>
                    <span>Help Center</span>
                  </a> -->
                  <a href="#" class="logout-link">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Log Out</span>
                  </a>
                </div>
              </nav>
            </div>
          </div>

          <!-- Content Area -->
          <div class="col-lg-9">
            <div class="content-area">
              <div class="tab-content">
                <!-- Orders Tab -->
                <div class="tab-pane fade show active" id="orders">
                  <div class="section-header" data-aos="fade-up">
                    <h2>My Redeem History</h2>
                    <div class="header-actions">
                      <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" placeholder="Search redeem rewards...">
                      </div>                     
                    </div>
                  </div>

                  <div class="orders-grid"></div>
                  <!-- Pagination -->
                  <div class="pagination-wrapper" data-aos="fade-up">
                    <button type="button" class="btn-prev" disabled="">
                      <i class="bi bi-chevron-left"></i>
                    </button>
                    <div class="page-numbers">
                      <button type="button" class="active">1</button>
                      <button type="button">2</button>
                      <button type="button">3</button>
                      <span>...</span>
                      <button type="button">12</button>
                    </div>
                    <button type="button" class="btn-next">
                      <i class="bi bi-chevron-right"></i>
                    </button>
                  </div>
                </div>

                <!-- Wishlist Tab -->
                <div class="tab-pane fade" id="points">
                  <div class="section-header" data-aos="fade-up">
                    <h2>My Points Balance</h2>
                    <div class="header-actions">
                    </div>
                  </div>

                  <div class="wishlist-grid" style="display: flex; justify-content: center; align-items: center; padding: 20px;">
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; border: 1px solid #ddd; border-radius: 12px; background: #f8f9fa; width: 100%; max-width: 100%; text-align: center;height: 50vh;">
                      <div style="font-size: 20px; font-weight: 500; color: #555;">
                        Your Current Points Balance
                      </div>
                      <div class="points-balance" style="font-size: 36px; font-weight: 700; color: #007bff; margin-top: 10px;">
                        
                      </div>
                    </div>
                  </div>
                </div>               

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="settings">
                  <div class="section-header" data-aos="fade-up">
                    <h2>Account Settings</h2>
                  </div>

                  <div class="settings-content">
                    <!-- Personal Information -->
                    <div class="settings-section" data-aos="fade-up">
                      <h3>Personal Information</h3>
                      <form class="php-email-form settings-form">
                        <div class="row g-3">
                          <div class="col-md-12">
                            <label for="userName" class="form-label">User Name</label>
                            <input type="text" class="form-control" id="userNameField" value="User 1" required="">
                          </div>
                          <div class="col-md-6">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="emailField" value="sarah@example.com" required="">
                          </div>
                          <div class="col-md-6">
                            <label for="phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="phoneField" value="+1 (555) 123-4567">
                          </div>
                          <!-- <div class="col-12">
                            <label for="aboutMe" class="form-label">About Me</label>
                            <textarea class="form-control" id="aboutMe" rows="5">Hello! I'm Sarah, a passionate shopper and fashion enthusiast. I love exploring new trends and finding unique pieces to add to my wardrobe. When I'm not shopping, you can find me traveling, trying out new recipes, or spending time with friends and family.</textarea>
                          </div> -->
                        </div>

                        <div class="form-buttons">
                          <button type="submit" class="btn-save">Save Changes</button>
                        </div>

                        <div class="loading">Loading</div>
                        <div class="error-message"></div>
                        <div class="sent-message">Your changes have been saved successfully!</div>
                      </form>
                    </div>
                
                    <!-- Security Settings -->
                    <div class="settings-section" data-aos="fade-up" data-aos-delay="200">
                      <h3>Security</h3>
                      <form class="php-email-form settings-form">
                        <div class="row g-3">
                          <div class="col-md-12">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required="">
                          </div>
                          <div class="col-md-6">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required="">
                          </div>
                          <div class="col-md-6">
                            <label for="confirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required="">
                          </div>
                        </div>

                        <div class="form-buttons">
                          <button type="submit" class="btn-save">Update Password</button>
                        </div>

                        <div class="loading">Loading</div>
                        <div class="error-message"></div>
                        <div class="sent-message">Your password has been updated successfully!</div>
                      </form>
                    </div>

                    <!-- Delete Account -->
                    <div class="settings-section danger-zone" data-aos="fade-up" data-aos-delay="300">
                      <h3>Delete Account</h3>
                      <div class="danger-zone-content">
                        <p>Once you delete your account, there is no going back. Please be certain.</p>
                        <button type="button" class="btn-danger">Delete Account</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

    </section><!-- /Account Section -->

  </main>

<footer id="footer" class="footer dark-background">
    <div class="footer-main">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-6 col-md-6">
            <div class="footer-widget footer-about">
              <a href="index.html" class="logo">
                <span class="sitename">Optima Bank Rewards</span>
              </a>
              <p>Your trusted partner in redeeming exclusive vouchers and managing your loyalty points with ease.</p>

              <div class="social-links mt-4">
                <h5>Connect With Us</h5>
                <div class="social-icons">
                  <a href="#" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
                  <a href="#" aria-label="Instagram"><i class="bi bi-instagram"></i></a>
                  <a href="#" aria-label="Twitter"><i class="bi bi-twitter-x"></i></a>
                  <a href="#" aria-label="TikTok"><i class="bi bi-tiktok"></i></a>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6 col-md-6">
            <div class="footer-widget">
              <h4>Contact Information</h4>
              <div class="footer-contact">
                <div class="contact-item">
                  <i class="bi bi-geo-alt"></i>
                  <span>Main branch - No 23, Jalan Melati 3, Bandar Melati, 75450 Alor Gajah, Melaka</span>
                </div>
                <div class="contact-item">
                  <i class="bi bi-telephone"></i>
                  <span>+60 12-345 6789</span>
                </div>
                <div class="contact-item">
                  <i class="bi bi-envelope"></i>
                  <span>info@optimabank.com</span>
                </div>
                <div class="contact-item">
                  <i class="bi bi-clock"></i>
                  <span>Monday-Friday: 9am - 6pm<br>Saturday & Sunday: 10am - 3.30pm</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="container">
        <div class="row gy-3 align-items-center">
          <div class="col-lg-6 col-md-12">
            <div class="copyright">
              <p>© <span>Copyright</span> <strong class="sitename">Optima Bank</strong>. All Rights Reserved.</p>
            </div>
            <div class="credits mt-1">
              Designed by The Glory - GIFT UTeM
            </div>
          </div>

          <div class="col-lg-6 col-md-12">
            <div class="d-flex flex-wrap justify-content-lg-end justify-content-center align-items-center gap-4">
              <div class="payment-methods">
                <div class="payment-icons">
                  <i class="bi bi-credit-card" aria-label="Credit Card"></i>
                  <i class="bi bi-paypal" aria-label="PayPal"></i>
                  <i class="bi bi-apple" aria-label="Apple Pay"></i>
                  <i class="bi bi-google" aria-label="Google Pay"></i>
                  <i class="bi bi-cash" aria-label="Cash on Delivery"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/drift-zoom/Drift.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Firebase Initialization and Auth State Management -->
  <script type="module">

    // 🔹 Reusable Toast Function
    function showToast(message, type = "success") {
      const toast = document.createElement("div");
      toast.className = `custom-toast ${type}`;
      toast.textContent = message;

      document.body.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } 
      from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
    import firebaseConfig from "./config.js";   // ✅ import the config

    // 🔹 Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const authButtons = document.getElementById("authButtons");
    const accountBtn = document.getElementById("accountBtn");
    const userName = document.getElementById("userName");
    const userAvatar = document.getElementById("userAvatar");
    const userNameField = document.getElementById("userNameField");
    const emailField = document.getElementById("emailField");
    const phoneField = document.getElementById("phoneField");

  document.addEventListener("DOMContentLoaded", function() {
      document.getElementsByClassName("logout-link")[0].addEventListener("click", function(e) {
          e.preventDefault();
          // if using Firebase Auth
          if (getAuth().currentUser) {
            signOut(getAuth()).then(() => {
              sessionStorage.removeItem("user");
              setTimeout(() => window.location.href = "index.html", 1500);
              showToast("Logged out successfully", "success");
            }).catch((error) => {
              showToast("Logout failed: " + error.message, "error");
            });
            return;
          }
          // else normal logout
          sessionStorage.removeItem("user");
          setTimeout(() => window.location.href = "index.html", 1500);
          showToast("Logged out successfully", "success");
      });
    });

    // 🔹 Listen for login state changes
  // 🔹 Check Firebase Auth first
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // Firebase user
      fetch("http://localhost/TheGlory/getUser.php?uid=" + user.uid)
        .then((res) => res.json())
        .then((dbUser) => {
          let photoURL = dbUser.profile_image || "assets/img/default-avatar.png";
          accountBtn.innerHTML = `
            <img src="${photoURL}" 
                alt="User Avatar" 
                class="rounded-circle" 
                style="width:32px; height:32px; object-fit:cover;">
          `;
          userName.textContent = dbUser.username || "User";
          userAvatar.src = photoURL;
          userNameField.value = dbUser.username || "";
          emailField.value = dbUser.email || "";
          phoneField.value = dbUser.phone || "";
          if (dbUser.points !== undefined) {
            document.querySelector('a.nav-link[href="#points"] .badge').textContent = dbUser.points;
            document.querySelector('.points-balance').textContent = `${dbUser.points} pts`;
          }
        });

      document.querySelector(".dropdown-header h6").textContent =
        `Welcome ${user.displayName}`;

      authButtons.innerHTML = `
        <button id="logoutBtn" class="btn btn-danger w-100">Logout</button>
      `;

      document.getElementById("logoutBtn").addEventListener("click", async () => {
        try {
          await signOut(auth);
          sessionStorage.removeItem("user"); // clear normal session too
          sessionStorage.removeItem("cartCount"); // clear cart count
          setTimeout(() => location.reload(), 1500);
          showToast("Logged out successfully", "success");
        } catch (err) {
          showToast("Logout failed: " + err.message, "error");
        }
      });

      const userResponse = await fetch("http://localhost/TheGlory/getUser.php?uid=" + user.uid);

      const userData = await userResponse.json();
      // if PHP returns array, take first element
      let userObj = Array.isArray(userData) ? userData[0] : userData;
      // Save session in browser
      sessionStorage.setItem("user", JSON.stringify({
        id: userObj.id,
        username: userObj.username,
        email: userObj.email,
        phone: userObj.phone_number,
        points: userObj.points,
      }));

      const cartResponse = await fetch("http://localhost/TheGlory/getCart.php?user_id=" + userObj.id);
      const cartData = await cartResponse.json();
      // Use "totalItems" from PHP response instead of length
      const cartCount = cartData.totalItems || 0;
      document.querySelector(".header-action-btn .badge").textContent = cartCount;  
      // save cart count to sessionStorage
      sessionStorage.setItem("cartCount", cartCount);    
    } else {
      // 🔹 If not Firebase, check normal login session
      const localUser = JSON.parse(sessionStorage.getItem("user"));
      const userName = document.getElementById("userName");
      const userAvatar = document.getElementById("userAvatar");
      const userNameField = document.getElementById("userNameField");
      const emailField = document.getElementById("emailField");
      const phoneField = document.getElementById("phoneField");

      if (localUser) {
        // Normal user UI update
        accountBtn.innerHTML = `
          <img src="assets/img/default-avatar.png"
              alt="User Avatar"
              class="rounded-circle"
              style="width:32px; height:32px; object-fit:cover;">
        `;

        document.querySelector(".dropdown-header h6").textContent =
          `Welcome ${localUser.username}`;

        authButtons.innerHTML = `
          <button id="logoutBtn" class="btn btn-danger w-100">Logout</button>
        `;

          userName.textContent = localUser.username || "User";
          userAvatar.src = localUser.profile_image || "assets/img/default-avatar.png";
          userNameField.value = localUser.username || "";
          emailField.value = localUser.email || "";
          phoneField.value = localUser.phone || "";
          if (localUser.points !== undefined) {
            document.querySelector('a.nav-link[href="#points"] .badge').textContent = localUser.points;
          }

        document.getElementById("logoutBtn").addEventListener("click", () => {
          sessionStorage.removeItem("user");
          setTimeout(() => location.reload(), 1500);
          showToast("Logged out successfully", "success");
        });

        const cartResponse = await fetch("http://localhost/TheGlory/getCart.php?user_id=" + localUser.id);
          const cartData = await cartResponse.json();
          // Use "totalItems" from PHP response instead of length
          const cartCount = cartData.totalItems || 0;
        document.querySelector(".header-action-btn .badge").textContent = cartCount;  
        // save cart count to sessionStorage
        sessionStorage.setItem("cartCount", cartCount);  

      } else {
        // Guest
        document.querySelector(".dropdown-header h6").textContent =
          `Welcome to Optima Bank`;

        authButtons.innerHTML = `
          <a href="login.html" class="btn btn-primary w-100 mb-2">Sign In</a>
          <a href="register.html" class="btn btn-outline-primary w-100">Register</a>
        `;

        const WholeSection = document.getElementById("ProfileSection");
        WholeSection.innerHTML = `
          <p>Please <a href="login.html" style="color: red;text-decoration: underline;">log in</a> to access your account.</p>
        `;        
      }
    }
  });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sidebarTabs = document.querySelectorAll(".menu-nav .nav-link[data-tab]");
      const dropdownTabs = document.querySelectorAll(".account-dropdown .dropdown-item[data-tab]");
      const panes = document.querySelectorAll(".tab-pane");

      // Dropdown clicks (reuse sidebar logic)
      dropdownTabs.forEach(tab => {
        tab.addEventListener("click", function (e) {
          e.preventDefault();
          // click the slider tab with same data-tab
          const targetTab = this.getAttribute("data-tab");
          const sidebarTab = document.querySelector(`.menu-nav .nav-link[data-tab="${targetTab}"]`);
          if (sidebarTab) {
            sidebarTab.click();
          }

          // Close dropdown after selection
          this.closest(".dropdown-menu").classList.remove("show");
        });
      });
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Check if URL has hash (#settings)
      var hash = window.location.hash;
      if (hash) {
        var tabTrigger = document.querySelector('a[href="' + hash + '"]');
        // click the slider tab with same data-tab
        const targetTab = hash.substring(1); // remove #
        const sidebarTab = document.querySelector(`.menu-nav .nav-link[data-tab="${targetTab}"]`);
        if (sidebarTab) {
          sidebarTab.click();
        }
        // scroll to top of screen within 500 ms
        setTimeout(() => { window.scrollTo(0, 0); }, 500);
      }
    });
  </script>

<script>
  let currentPage = 1;
  const itemsPerPage = 5;
  let allOrders = [];

  async function loadOrders(search = "") {
    const user = JSON.parse(sessionStorage.getItem("user"));
    if (!user) return;

    const res = await fetch(`http://localhost/TheGlory/getRedeemHistory.php?user_id=${user.id}&search=${encodeURIComponent(search)}`);
    allOrders = await res.json(); // save globally

    currentPage = 1; // reset page on search
    renderOrdersPage();
    renderPagination();
  }

  function renderOrdersPage() {
    const ordersGrid = document.querySelector(".orders-grid");
    ordersGrid.innerHTML = ""; // Clear old results

    if (allOrders.length === 0) {
      ordersGrid.innerHTML = `<p>No redeem history found.</p>`;
      return;
    }

    document.querySelector('a.nav-link[href="#orders"] .badge').textContent = allOrders.length;

    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const ordersToShow = allOrders.slice(start, end);

    ordersToShow.forEach((o, idx) => {
      const card = document.createElement("div");
      card.className = "order-card";
      // card.setAttribute("data-aos", "fade-up");
      // card.setAttribute("data-aos-delay", 100 + idx * 50);

      card.innerHTML = `
        <div class="order-header">
          <div class="order-id">
            <span class="label" style="font-size: medium;">Voucher Code:</span>
            <span class="value" style="font-size: medium;">${o.code}</span>
          </div>
          <div class="order-date" style="font-size: medium;">${o.completed_date}</div>
        </div>
        <div class="order-content" style="display: flex; align-items: center; justify-content: space-between;">
          <div class="product-grid" style="display: flex; align-items: center; justify-content: center; height: 100%; width: 40%;">
            <img src="${o.image}" alt="Product" loading="lazy" style="width: 60%; height: 60%;">
          </div>
          <div class="order-info" style="display: flex; flex-direction: column; align-items: flex-start; justify-content: center; height: 100%; width: 60%;">
            <div class="info-row">
              <span style="font-size: 19px; font-weight: 600; color: black;">${o.title}</span>
            </div>
            <div class="info-row">
              <span style="font-size: 17px;">Status</span>
              <span class="status delivered" style="font-size: 17px;">Redeemed</span>
            </div>
            <div class="info-row">
              <span style="font-size: 17px;">Points Used:</span>
              <span style="padding-left: 5px; font-size: 17px; color: #44444499;">${o.points_used} pts</span>
            </div>
            <div class="order-footer info-row" style="margin-top: 10px; width: 100%;">
              <button type="button" class="btn-details" onclick="viewOrderDetails(${o.voucher_id})">View Details</button>
            </div>
          </div>
        </div>
      `;
      ordersGrid.appendChild(card);
    });
  }

  function renderPagination() {
    const paginationWrapper = document.querySelector(".pagination-wrapper");
    const totalPages = Math.ceil(allOrders.length / itemsPerPage);
    const pageNumbersDiv = paginationWrapper.querySelector(".page-numbers");
    pageNumbersDiv.innerHTML = "";

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.className = i === currentPage ? "active" : "";
      btn.addEventListener("click", () => {
        currentPage = i;
        renderOrdersPage();
        renderPagination();
      });
      pageNumbersDiv.appendChild(btn);
    }

    // Previous & Next buttons
    const btnPrev = paginationWrapper.querySelector(".btn-prev");
    const btnNext = paginationWrapper.querySelector(".btn-next");

    btnPrev.disabled = currentPage === 1;
    btnNext.disabled = currentPage === totalPages;

    btnPrev.onclick = () => {
      if (currentPage > 1) {
        currentPage--;
        renderOrdersPage();
        renderPagination();
      }
    };

    btnNext.onclick = () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderOrdersPage();
        renderPagination();
      }
    };
  }

  // 🔹 Load on page open
  document.addEventListener("DOMContentLoaded", () => {
    loadOrders();

    // 🔹 Search field listener
    const searchBox = document.querySelector("#orders .search-box input");
    searchBox.addEventListener("input", (e) => {
      loadOrders(e.target.value);
    });
  });

  function viewOrderDetails(orderId) {
    window.location.href = `voucher-details.html?id=${orderId}`;
  }
  </script>

</body>

</html>